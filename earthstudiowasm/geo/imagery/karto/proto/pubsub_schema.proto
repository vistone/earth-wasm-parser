syntax = "editions";

package geo.imagery.karto.proto;

import "geo/imagery/karto/proto/app_options.proto";
import "geo/imagery/karto/proto/camera_move.proto";
import "geo/imagery/karto/proto/frame.proto";
import "geo/imagery/karto/proto/movie_actor_parameters.proto";
import "geo/imagery/karto/proto/world_state.proto";
import "geo/render/mirth/apps/mirthrender/batch/mapfacts_params.proto";
import "geo/render/mirth/apps/mirthrender/batch/poi_animation_params.proto";

option java_multiple_files = true;

message StreetLevelCameraPath {
    optional string selected_run_id = 1;
    
    optional PanoTimeRange time_range = 2;
    message PanoTimeRange {
        optional string start_timestamp = 1;
        optional string end_timestamp = 2;
    }
    
    repeated string ordered_pano_ids = 3;
    
    oneof GeometryModel {
        RenderCameraTargets render_camera_targets = 4;
    }
    
    message RenderCameraTargets {
        repeated string matrices = 1;
    }
}

message RenderRequestMetadata {
    optional int64 render_priority = 1;
}

message MovieRequest {
    optional string place_id = 1;
    
    optional Output output = 2;
    message Output {
        optional string bucket_name = 1;
        optional string object_name = 2;
    }
    
    optional double duration_seconds = 3 [default = 30];
    optional int32 frames_per_second = 4 [default = 30];
    
    optional ImageSize image_size = 5;
    message ImageSize {
        optional int32 width = 1 [default = 1080];
        optional int32 height = 2 [default = 1920];
    }
    
    optional WorldState world_state = 15;
    optional AppOptions app_options = 16;
    
    optional TilesetParameters tileset_parameters = 6;
    message TilesetParameters {
        optional int32 target_screen_space_error = 1 [default = 8];
        optional float sufficient_screen_space_error = 2 [default = 128];
        optional bool horizon_cull = 3 [default = true];
        optional bool enable_frustum_culling = 4 [default = false];
        optional float outside_frustum_screen_space_error = 5 [default = 256];
        optional int32 maximum_simultaneous_tile_loads = 6 [default = 1000];
        optional int32 per_frame_gltf_mesh_load_limit = 12 [default = 0];
        optional bool use_absolute_transform = 7 [default = true];
        optional bool unpopping = 8 [default = false];
        optional float unpopping_duration = 9 [default = 0.5];
        optional CollisionEnabled collision_enabled = 10 [default = QUERY_ONLY];
        optional bool use_disk_cache = 11 [default = false];
    }
    
    optional MovieQuality movie_quality = 8 [default = HIGH_QUALITY];
    enum MovieQuality {
        UNKNOWN_QUALITY = 0;
        LOW_QUALITY = 1;
        HIGH_QUALITY = 2;
        HIGH_QUALITY_WITH_UI = 3;
    }
    
    optional bool dynamic_water = 9 [default = true];
    optional bool calculate_fixed_tiles = 17 [default = false];
    optional double fixed_tiles_orbit_sample_interval_seconds = 18 [default = 0.25];
    
    optional MovieRequestType movie_request_type = 20;
    enum MovieRequestType {
        UNKNOWN_MOVIE_REQUEST_TYPE = 0;
        AERIAL = 1;
        DRIVE_BY_STREET_LEVEL = 2;
    }
    
    optional CameraMove camera_move = 21;
    
    oneof camera_path {
        MovieActorParameters movie_actor_parameters = 13;
        ERSParameters ers_parameters = 12;
        PrecomputedCameraPath precomputed_camera_path = 14;
        StreetLevelCameraPath street_level_camera_path = 19;
    }
    
    reserved 7, 10, 11;
    
    message ERSParameters {
        optional mirth_apps_mirthrender.MapFactsParams map_facts_params = 1;
        optional mirth_apps_mirthrender.PoiAnimationParams poi_animation_params = 2;
    }
    
    message PrecomputedCameraPath {
        repeated Frame frames = 1;
    }
    
    enum CollisionEnabled {
        UNKNOWN_COLLISION = 0;
        NO_COLLISION = 1;
        QUERY_ONLY = 2;
        PHYSICS_ONLY = 3;
        QUERY_AND_PHYSICS = 4;
    }
}
